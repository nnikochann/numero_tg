# ИИ-Нумеролог - Телеграм-бот

Телеграм-бот "ИИ-Нумеролог" выполняет нумерологические расчеты, предоставляет персонализированные отчеты и прогнозы на основе искусственного интеллекта.

## Основные функции

- Сбор данных пользователя (ФИО, дата рождения)
- Выполнение нумерологических расчетов
- Предоставление бесплатного мини-отчета
- Генерация и отправка платного полного PDF-отчета
- Еженедельные прогнозы для подписчиков
- Управление настройками и подпиской

## Технический стек

- **Python 3.10+** - основной язык программирования
- **aiogram 3.x** - фреймворк для создания Telegram ботов
- **SQLite** - база данных для хранения информации о пользователях и заказах
- **n8n** - для интеграции с API искусственного интеллекта
- **ЮKassa** - для обработки платежей
- **Docker** - для контейнеризации и развертывания
- **weasyprint/reportlab** - для генерации PDF-отчетов

## Структура проекта

```
ИИ-Нумеролог/
├── bot.py                      # Основной файл бота
├── numerology_core.py          # Модуль для нумерологических расчетов
├── database_sqlite.py          # Модуль работы с базой данных SQLite
├── interpret.py                # Модуль для интеграции с n8n и ИИ
├── payment_webhook_yukassa.py  # Обработчик вебхуков платежей ЮKassa
├── pdf_generator.py            # Модуль для генерации PDF-отчетов
├── pdf_template.html           # HTML-шаблон для генерации PDF
├── weekly_forecast.py          # Скрипт для отправки еженедельных прогнозов
├── setup_weekly_forecast.sh    # Скрипт для настройки cron-задачи
├── test_bot.sh                 # Скрипт для тестирования функциональности
├── requirements.txt            # Зависимости проекта
├── schema.sql                  # Схема базы данных
├── dockerfile                  # Инструкции для сборки Docker-образа
├── docker-compose.yml          # Конфигурация Docker-композиции
└── README.md                   # Документация проекта
```

## Установка и запуск

### Запуск с Docker в тестовом режиме

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/your-username/numerology-bot.git
   cd numerology-bot
   ```

2. Создайте файл `.env` с необходимыми переменными окружения:
   ```
   # Telegram Bot
   BOT_TOKEN=your_bot_token_here
   
   # Тестовый режим (без реальных платежей)
   TEST_MODE=true
   
   # Настройки n8n
   EXTERNAL_WEBHOOK_URL=https://your-n8n-instance.com/webhook/your-webhook-id
   
   # Настройки ЮKassa (для продакшн)
   YUKASSA_SECRET_KEY=your_yukassa_secret_key
   ```

3. Запустите контейнеры:
   ```bash
   docker-compose up -d
   ```

4. Проверьте логи:
   ```bash
   docker-compose logs -f bot
   ```

В тестовом режиме (`TEST_MODE=true`) бот будет работать без реальных платежей, предоставляя возможность тестировать все функции бесплатно.

### Настройка для продакшн

Для запуска в продакшн режиме с реальными платежами:

1. Получите API-ключ и секретный ключ от ЮKassa

2. Обновите `.env` файл:
   ```
   # Telegram Bot
   BOT_TOKEN=your_bot_token_here
   
   # Деактивация тестового режима
   TEST_MODE=false
   
   # Настройки n8n
   EXTERNAL_WEBHOOK_URL=https://your-n8n-instance.com/webhook/your-webhook-id
   
   # Настройки ЮKassa
   YUKASSA_SECRET_KEY=your_yukassa_secret_key
   
   # Вебхук для продакшна
   WEBHOOK_HOST=https://your-domain.com
   ```

3. Перезапустите контейнеры:
   ```bash
   docker-compose down
   docker-compose up -d
   ```

### Настройка еженедельных прогнозов

Для настройки автоматической отправки еженедельных прогнозов:

```bash
# Сделайте скрипт исполняемым
chmod +x setup_weekly_forecast.sh

# Запустите скрипт для настройки cron-задачи
./setup_weekly_forecast.sh
```

Скрипт настроит cron-задачу для запуска `weekly_forecast.py` каждый понедельник в 8:00.

## Настройка n8n для ИИ-интеграции

1. Настройте свой сервер n8n (или используйте облачную версию).

2. Создайте следующие рабочие процессы (workflows):
   - Для обработки мини-отчетов
   - Для обработки полных отчетов
   - Для еженедельных прогнозов

3. Настройте каждый процесс для интеграции с AI (OpenAI, Claude и т.д.)

4. Укажите URL вашего webhook в файле `.env` (EXTERNAL_WEBHOOK_URL).

В тестовом режиме интеграция с n8n не требуется - бот будет генерировать тестовые ответы автоматически.

## Настройка платежей через ЮKassa

1. Зарегистрируйтесь в [ЮKassa](https://yookassa.ru/developers)
2. Получите API-ключ и секретный ключ
3. Укажите их в файле `.env`
4. Настройте вебхук для получения уведомлений о платежах

## Команды бота

- `/start` - Запуск бота и начало взаимодействия
- `/report` - Получение последнего купленного отчета
- `/subscribe` - Управление подпиской на еженедельные прогнозы
- `/help` - Справка и информация о боте
- `/settings` - Настройки языка и уведомлений

## Тестирование

Для тестирования функциональности бота используйте скрипт:

```bash
# Сделайте скрипт исполняемым
chmod +x test_bot.sh

# Запустите тестирование
./test_bot.sh
```

Скрипт проверит наличие всех необходимых файлов, зависимостей, протестирует модули нумерологических расчетов, интеграцию с n8n, генерацию PDF и еженедельные прогнозы.

## Лицензия

Проект распространяется под лицензией MIT.

## Поддержка

По всем вопросам и предложениям обращайтесь через issues в GitHub или напрямую к администратору бота.
